sudo: false
language: python
python:
  - '3.6'
cache: pip
install:
  - pip install -r requirements.txt
  - pip install -e .
before_script:
  - wget https://s3-us-west-2.amazonaws.com/dynamodb-local/dynamodb_local_latest.tar.gz -O /tmp/dynamodb_local_latest.tar.gz
  - tar -xzf /tmp/dynamodb_local_latest.tar.gz -C /tmp
  - java -Djava.library.path=/tmp/DynamoDBLocal_lib -jar /tmp/DynamoDBLocal.jar -inMemory &
  - sleep 2
env:
  - AWS_SECRET_ACCESS_KEY=mock AWS_ACCESS_KEY_ID=mock
script:
  - make test
  - make lint
jobs:
  include:
    - stage: deploy
      python: '3.6'
      deploy:
        provider: pypi
        user: lyft-pynamodb-attributes
        password:
          secure: "cANkMRW0rMURzfNIPIGanbZgKGs1LD/uW15+plgEVE7+9lfPD/0/aACqNVFTWsgVm6LyjqYTdpR8Qmu87ZWoZbQnJXnPNOv/fjovTfirZJRpUOI7N3n2JDY3WUCLf9qO5O1APpILXw4VRt1OmEcbf/sxzmcy/eCTkVHSpxVupHUl5hGGRYvTCNZ2NmemYdvA1i9o0Vg7w+Z7s9UqpAcAewNGlZKLiBPoiXtYV4yeMtDbUhVCbGOMZ5nXW5wmZ5HsN7giO1KdrtIN6L41dtyiWKF0bKa8VMlNhOqMFL2m+6XfiSUSngn+XrXao2CRR+g+nJgCF+xPNDCiUGddFdcAtnd7ttbl6XsYZORrWM53Ujcb2FpScRjiEPsdePRWBcEHInpotGfOS6atztXCEc5QI4UdP62Dd5XAtWQpbv2IBbyFnHhYX/Z9QWzKz6qXbOj2XSMWbsHSLdEP4Z76CKNP7LSVPrh8QRRFy5WKS+Fb0GleOOeO8hYod7msCDmNUq0oU/5JnKXIn0lssB42+mzX2jvzrViw7DJLoRCgTqEh664TbbFA5g4dF4f6aJ67MdJxKobN5f4vC8wClhfEO20LlbDFG2pYO4P+4mFVPst7DJwQwazjZmzkH3/iNL5yoFPse/R/3MwY8JGchwjAPIKADkbNkL59baccBJyeuBemoRs="
        on:
          tags: true
          distributions: sdist
          repo: lyft/pynamodb-attributes
